name: ğŸš€ Deploy Manual

on:
  workflow_dispatch:
    inputs:
      branch:
        description: 'Branch para fazer deploy'
        required: true
        default: 'main'
        type: string
      ambiente:
        description: 'Ambiente de destino'
        required: true
        default: 'producao'
        type: choice
        options:
          - producao

jobs:
  deploy:
    name: Deploy â†’ ${{ github.event.inputs.ambiente }} (${{ github.event.inputs.branch }})
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“‹ InformaÃ§Ãµes do Deploy
        run: |
          echo "============================================"
          echo "ğŸŒ¿ Branch:     ${{ github.event.inputs.branch }}"
          echo "ğŸ¯ Ambiente:   ${{ github.event.inputs.ambiente }}"
          echo "ğŸ‘¤ Solicitado: ${{ github.actor }}"
          echo "ğŸ• HorÃ¡rio:    $(date -u '+%Y-%m-%d %H:%M:%S UTC')"
          echo "============================================"

      - name: ğŸ” Deploy via SSH na VPS
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: ${{ secrets.VPS_HOST }}
          username: ${{ secrets.VPS_USER }}
          key: ${{ secrets.VPS_KEY }}
          port: ${{ secrets.VPS_PORT }}
          command_timeout: 15m
          script: |
            set -e
            BRANCH="${{ github.event.inputs.branch }}"
            AMBIENTE="${{ github.event.inputs.ambiente }}"

            echo "ğŸš€ Iniciando deploy â€” Branch: $BRANCH | Ambiente: $AMBIENTE"

            cd ~/net-imobiliaria
            chmod +x scripts/vps/deploy-github.sh
            ./scripts/vps/deploy-github.sh "$BRANCH" "$AMBIENTE"

      - name: âœ… Deploy ConcluÃ­do
        run: |
          echo "Deploy de '${{ github.event.inputs.branch }}' para '${{ github.event.inputs.ambiente }}' concluÃ­do!"
